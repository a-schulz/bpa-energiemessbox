= IIoT Gefahrenbereich-Warnsystem

== Übersicht

Diese Applikation wurde für das IIoT Testbed der HTWD Dresden entwickelt, um Mitarbeitende vor Gefahrenbereichen zu warnen. Das System überwacht Druckluftversorgungssysteme und erkennt Störungen wie Druckabfälle. Wenn ein Mitarbeiter einen Bereich mit einer technischen Störung betritt, erhält dieser eine Warnung über einen speziellen Handschuh mit Vibrationsfeedback.

Excact task specified in link:task.md[task.md].

== Architektur

=== Systemkomponenten

* *Energiemessbox*: Erfasst Messdaten zu Druck und Luftfluss via OPC UA
* *ZIGPOS*: Liefert Positionsdaten der Mitarbeiter
* *Node-RED*: Liest Messdaten aus verschiedenen Quellen und verarbeitet sie
* *Drools*: Business Rules Engine zur Auswertung von Geschäftsregeln
* *Asset Administration Shell (AAS)*: Modelliert das Druckluftsystem als Asset
* *MQTT Message Broker*: Ermöglicht die Kommunikation zwischen den Komponenten
* *Handschuh*: IoT-Gerät, das Warnungen empfängt und Vibrationsfeedback gibt
= IIoT Gefahrenbereich-Warnsystem

== Übersicht

Diese Applikation wurde für das IIoT Testbed der HTWD Dresden entwickelt, um Mitarbeitende vor Gefahrenbereichen zu warnen. Das System überwacht Druckluftversorgungssysteme und erkennt Störungen wie Druckabfälle. Wenn ein Mitarbeiter einen Bereich mit einer technischen Störung betritt, erhält dieser eine Warnung über einen speziellen Handschuh mit Vibrationsfeedback.

Excact task specified in link:task.md[task.md].

== Architektur

=== Systemkomponenten

* *Energiemessbox*: Erfasst Messdaten zu Druck und Luftfluss via OPC UA
* *ZIGPOS*: Liefert Positionsdaten der Mitarbeiter
* *Node-RED*: Liest Messdaten aus verschiedenen Quellen und verarbeitet sie
* *Drools*: Business Rules Engine zur Auswertung von Geschäftsregeln
* *Asset Administration Shell (AAS)*: Modelliert das Druckluftsystem als Asset
* *MQTT Message Broker*: Ermöglicht die Kommunikation zwischen den Komponenten
* *Handschuh*: IoT-Gerät, das Warnungen empfängt und Vibrationsfeedback gibt

=== Systemdiagramm

Das Systemdiagramm ist im PlantUML-Format unter `system_diagram.puml` verfügbar und visualisiert die Interaktion der verschiedenen Komponenten.

image::docs/system_diagram.png[System Diagramm]

Das Nodered ist die zentrale Komponente wo alle Daten aus den unterschiedlichen Komponenten rein gehen und versendet werden Da die Energiemessbox nur Polling unterstützt fragt Nodered aller 50 Millisekunden einen neuen Wert ab.
Das Nodered bekommt aus folgenden Systemen Daten:

* Druckluftdaten, also der derzeitige Druck und der derzeitige Lufstrom beides in Bar kommt über OPCUA an das Nodered.Die Variablennamen aus dem OPCUA sind rFlow und rPressure die NodeIds sind folgende:

** ns=2;s=|var|CECC-LK.Application.GVL.rPressure

** ns=2;s=|var|CECC-LK.Application.GVL.rFlow



* Die Koordinaten des Zigpos Systems kommen über eine Websocketverbindung in das Nodered. Dabei muss zuerst über REST eine API Key abgefragt werden der 60 Minuten gültig ist und deswegen nach 55 Minuten neu abgefragt wird. Mit diesen Key wird eine Websocketverbindung aufgebaut die auf das Topic POSITIONS hört und jedes Mal eine neue Position bekommt wenn der Zigpos Tag seine Position ändert.

=== DMN Diagramm

Das DMN Diagramm beschreibt die Geschäftsregeln. In dem Fall wann eine Warnung an den MD5 Stick geschickt werden soll.

image::docs/dmn_overview.png[DMN Diagramm]

Bei "Störung erkennen" geht es darum wann die Daten aus der Energiemessbox als Störung erkannt werden soll.

image::docs/dmn_stoerung_erkennen.png[DMN Diagramm]

Aktuell wird eine Störung ausgegeben wenn der Luftstrom größer 10 Bar ist und der Druck auf der Anlange kleiner als 5,5 Bar


image::docs/dmn_person_bereich.png[DMN Diagramm]

Ob sich eine Person im Gefahrenbereich befindet entscheidet sich anhand dieses Diagramms.

=== Technische Details

1. OPC-UA zur Abfrage der Druckluftversorgungsdaten
2. MQTT für die lose Kopplung der Systemkomponenten
3. AAS (Asset Administration Shell) für die Modellierung des Druckluftsystems
4. Node-RED für die Low-Code Entwicklung
5. Drools als Business Rule Management System

== Getting Started

1. Starten Sie den MQTT Broker
2. Stellen Sie die Verbindung zur Energiemessbox über OPC UA her
3. Konfigurieren Sie die ZIGPOS-Verbindung für Positionsdaten
4. Importieren Sie die Node-RED Flows
5. Starten Sie die Drools-Engine mit den konfigurierten Geschäftsregeln
6. Verbinden Sie den Handschuh mit dem MQTT Broker
